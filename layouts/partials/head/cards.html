{{- /* Retrieve what is needed and store in local variables */ -}}

{{- /* Print debug statement if flag is set */ -}}
{{- if .Site.Params.include_debug_comments -}}
{{ printf "\n<!-- BEGIN layouts/partials/head/cards.html -->\n" | safeHTML }}
{{- end -}}

{{- /* Determine site name */ -}}
{{- $site_name := .Site.Title -}}

{{- /* Determine the title */ -}}
{{- $title := .Title -}}

{{- /* Determine description */ -}}
{{- $description := default (default .Site.Params.description .Description) .Summary -}}

{{- $image := default (default .Site.Data.cards.default (index .Site.Data.cards (urls.Parse .Permalink).Path)) (index .Params.images 0) -}}
{{- /*with .Params.images -}}
  {{- $image = (index . 0 | absURL) -}}
{{- else -}}
  {{- $path := (urls.Parse .Permalink).Path -}}
  {{- with (index .Site.Data.cards $path) -}}{{- $image = . -}}{{- end -}}
{{- end */ -}}

{{- $section := false -}}
{{- $categories := false -}}


{{- $iso8601 := "2006-01-02T15:04:05-07:00" -}}
{{- $published_time := false -}}
{{- $modified_time := false -}}

{{- $updated_time := false -}}

{{- if .IsPage -}}
  {{- if not .PublishDate.IsZero }}
    {{- $published_time = (.PublishDate.Format $iso8601 | safeHTML) -}}
  {{- else if not .Date.IsZero -}}
    {{ $published_time = (.Date.Format $iso8601 | safeHTML) -}}
  {{- end -}}
  {{- if not .Lastmod.IsZero }}{{- $modified_time = (.Lastmod.Format $iso8601 | safeHTML) -}}{{- end -}}
  {{- if ne (len .Section) 0 -}}{{- $section = .Section -}}{{- end -}}
  {{- if .Page.Params.categories -}}{{- $categories = .Page.Params.categories -}}{{- end -}}
{{- else if not .Date.IsZero -}}
  {{- $updated_time = (.Date.Format $iso8601 | safeHTML) -}}
{{- end -}}

{{- $audio := false -}}
{{- $type := "website" -}}
{{- with .Params.audio -}}
{{- $audio = (index . 0 | absURL) -}}
{{- $type = "music.song" -}}
{{- else -}}
{{- if .Title -}}{{- $type = "article" -}}{{- end -}}
{{- end -}}

{{- /* Create meta tags using the variable values. */ -}}
<meta property="og:url" content="{{ $url }}" />
<meta property="og:site_name" content="{{ $site_name }}" />
<meta property="og:title" content="{{ $title }}" />
<meta property="og:description" content="{{ $description }}" />
<meta property="og:image" content="{{ $image }}" />
{{- with $published_time }}
<meta property="article:published_time" content="{{ . }}" />
{{ end -}}
{{- with $modified_time }}
<meta property="article:modified_time" content="{{ . }}" />
{{ end -}}
{{- with $section }}
<meta property="article:section" content="{{ . }}" />
{{ end -}}
{{- with $categories }}
  {{- range first 6 . -}}
<meta property="article:tag" content="{{ . }}" />
  {{- end -}}
{{ end -}}
{{- with $updated_time }}
<meta property="og:updated_time" content="{{ . }}" />
{{ end -}}
{{- with $audio }}
<meta property="og:audio" content="{{ . }}" />
{{ end -}}
<meta property="og:type" content="{{ $type }}" />

<meta name="twitter:card" content="summary_large_image"/>
{{- with .Site.Params.twitter_username }}
<meta name="twitter:site" content="@{{ . }}" />
<meta name="twitter:creator" content="@{{ . }}" />
{{ end -}}
<meta property="twitter:domain" content="moondeer.micro.blog">
<meta property="twitter:url" content="{{ $url }}">
<meta name="twitter:title" content="{{ $title }}" />
<meta name="twitter:description" content="{{ $description }}" />
<meta name="twitter:image" content="{{ replace $image "moondeer.blog" "moondeer.micro.blog" }}" />

{{- if .Site.Params.include_debug_comments -}}
{{ printf "\n<!-- END layouts/partials/head/cards.html -->\n" | safeHTML }}
{{- end -}}