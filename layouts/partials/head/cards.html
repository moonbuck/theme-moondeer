{{- /* Created after learning from the twitter cards plugin and the Hugo open graph template */ -}}
{{- /* Currently configured for posts with a title and image, category list pages, and falls back to something suitable for the homepage. Gave up on video support but audio is supported */ -}}

{{- /* Retrieve what is needed and store in local variables */ -}}
{{- if .Site.Params.include_debug_comments }}
{{ printf "<!-- BEGIN layouts/partials/cards.html -->" | safeHTML }}
{{ end -}}
{{- $url := .Permalink -}}
{{- $site_name := .Site.Title -}}
{{- $title := .Title | default $site_name -}}
{{- $description := .Site.Params.description -}}
{{- if .Description -}}
  {{- $description = .Description -}}
{{- else if .IsPage -}}
  {{- $description = .Summary -}}
{{- end -}}
{{- $image := .Site.Data.cards.default -}}
{{- with .Params.images -}}
  {{- $image = (index . 0 | absURL) -}}
{{- else -}}
  {{- $path := (urls.Parse .Permalink).Path -}}
  {{- with (index .Site.Data.cards $path) -}}{{- $image = . -}}{{- end -}}
{{- end -}}
{{- $iso8601 := "2006-01-02T15:04:05-07:00" -}}
{{- $published_time := false -}}
{{- $modified_time := false -}}
{{- $section := false -}}
{{- $categories := false -}}
{{- $updated_time := false -}}
{{- if .IsPage -}}
  {{- if not .PublishDate.IsZero }}
    {{- $published_time = (.PublishDate.Format $iso8601 | safeHTML) -}}
  {{- else if not .Date.IsZero -}}
    {{ $published_time = (.Date.Format $iso8601 | safeHTML) -}}
  {{- end -}}
  {{- if not .Lastmod.IsZero }}{{- $modified_time = (.Lastmod.Format $iso8601 | safeHTML) -}}{{- end -}}
  {{- if ne (len .Section) 0 -}}{{- $section = .Section -}}{{- end -}}
  {{- if .Page.Params.categories -}}{{- $categories = .Page.Params.categories -}}{{- end -}}
{{- else if not .Date.IsZero -}}
  {{- $updated_time = (.Date.Format $iso8601 | safeHTML) -}}
{{- end -}}
{{- $audio := false -}}
{{- $type := "website" -}}
{{- with .Params.audio -}}
{{- $audio = (index . 0 | absURL) -}}
{{- $type = "music.song" -}}
{{- else -}}
{{- if .Title -}}{{- $type = "article" -}}{{- end -}}
{{- end -}}

{{- /* Create meta tags using the variable values. */ -}}
<meta property="og:url" content="{{ $url }}" />
<meta property="og:site_name" content="{{ $site_name }}" />
<meta property="og:title" content="{{ $title }}" />
<meta property="og:description" content="{{ $description }}" />
<meta property="og:image" content="{{ $image }}" />
{{- with $published_time }}
<meta property="article:published_time" content="{{ . }}" />
{{ end -}}
{{- with $modified_time }}
<meta property="article:modified_time" content="{{ . }}" />
{{ end -}}
{{- with $section }}
<meta property="article:section" content="{{ . }}" />
{{ end -}}
{{- with $categories }}
  {{- range first 6 . -}}
<meta property="article:tag" content="{{ . }}" />
  {{- end -}}
{{ end -}}
{{- with $updated_time }}
<meta property="og:updated_time" content="{{ . }}" />
{{ end -}}
{{- with $audio }}
<meta property="og:audio" content="{{ . }}" />
{{ end -}}
<meta property="og:type" content="{{ $type }}" />

<meta name="twitter:card" content="summary_large_image"/>
{{- with .Site.Params.twitter_username }}
<meta name="twitter:site" content="@{{ . }}" />
<meta name="twitter:creator" content="@{{ . }}" />
{{ end -}}
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:domain" content="moondeer.blog">
<meta property="twitter:url" content="{{ $url }}">
<meta name="twitter:title" content="{{ $title }}" />
<meta name="twitter:description" content="{{ $description }}" />
{{- if .Site.Params.include_debug_comments }}
{{ printf "<!-- END layouts/partials/cards.html -->" | safeHTML }}
{{ end -}}