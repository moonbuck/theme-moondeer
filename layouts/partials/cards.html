{{/* Created after learning from the twitter cards plugin and the Hugo open graph template */}}
{{/* Currently configured for posts with a title and image, category list pages, and falls back to something suitable for the homepage. Gave up on video support but audio is supported */}}

{{/* Retrieve what is needed and store it in `.Scratch` */}}
{{ .Scratch.Set "url" .Permalink }}
{{ .Scratch.Set "site_name" .Site.Title }}
{{ if .Title }} 
  {{ .Scratch.Set "title" .Title }}
{{ else }} 
  {{ .Scratch.Set "title" (.Scratch.Get "site_name") }}
{{ end }}
{{ if .Description }}
  {{ .Scratch.Set "description" .Description }}
{{ else if .IsPage }}
  {{ .Scratch.Set "description" .Summary }}
{{ else }}
  {{ .Scratch.Set "description" "All the latest things to fall out my head." }}
{{ end }}
{{ with $.Params.images }}
  {{ $.Scratch.Set "image" (index . 0 | absURL) }}
{{- else -}}
  {{ $url := urls.Parse .Permalink }}
  {{ $parts := split $url.Path "/" }}
  {{ $kind := index $parts 1 }}
  {{ $prefix := "https://moondeer.blog/uploads/2021/" }}
  {{ if eq $kind "categories" }}
    {{ $category := index $parts 2 }}
    {{ if eq $category "perspectives" }}
    {{- .Scratch.Set "image" (printf "%s/fa637e7fe0.png" $prefix) -}}
    {{ else if eq $category "projects" }}
    {{- .Scratch.Set "image" (printf "%s/74512379fa.png" $prefix) -}}
    {{ else if eq $category "poetry" }}
    {{- .Scratch.Set "image" (printf "%s/02bec3693a.png" $prefix) -}}
    {{ else if eq $category "music" }}
    {{- .Scratch.Set "image" (printf "%s/b604ce0519.png" $prefix) -}}
    {{ else if eq $category "programming" }}
    {{- .Scratch.Set "image" (printf "%s/0d2564a5e5.png" $prefix) -}}
    {{ else if eq $category "critters" }}
    {{- .Scratch.Set "image" (printf "%s/e0dfd20403.png" $prefix) -}}
    {{ else if eq $category "stream-of-consciousness" }}
    {{- .Scratch.Set "image" (printf "%s/b48fce578f.png" $prefix) -}}
    {{ else if eq $category "biographical-tripe" }}
    {{- .Scratch.Set "image" (printf "%s/ac4a187662.png" $prefix) -}}
    {{ else if eq $category "artsy-fartsy" }}
    {{- .Scratch.Set "image" (printf "%s/608bfd1756.png" $prefix) -}}
    {{ else if eq $category "personal-favorites" }}
    {{- .Scratch.Set "image" (printf "%s/7529b05b3e.png" $prefix) -}}
    {{ else }}
    {{- .Scratch.Set "image" (printf "%s/8135337116.png" $prefix) -}}
    {{ end }}
  {{ else if eq $kind "about" }}
    {{- .Scratch.Set "image" (printf "%s/87eced620f.png" $prefix) -}}
  {{ else if eq $kind "cloud" }}
    {{- .Scratch.Set "image" (printf "%s/bc53f58e45.png" $prefix) -}}
  {{ else }}
    {{- .Scratch.Set "image" (printf "%s/8135337116.png" $prefix) -}}
  {{- end -}}
{{ end }}
{{- $iso8601 := "2006-01-02T15:04:05-07:00" -}}
{{ if .IsPage }}
  {{- if not .PublishDate.IsZero }}
    {{ .Scratch.Set "published_time" (.PublishDate.Format $iso8601 | safeHTML) }}
  {{- else if not .Date.IsZero }}
    {{ .Scratch.Set "published_time" (.Date.Format $iso8601 | safeHTML) }}
  {{- end -}}
  {{- if not .Lastmod.IsZero }}
    {{ .Scratch.Set "modified_time" (.Lastmod.Format $iso8601 | safeHTML) }}
  {{- end -}}
  {{ if ne (len .Section) 0 }}
    {{ .Scratch.Set "section" .Section }}
  {{ end }}
  {{- if .Page.Params.categories -}}
    {{- .Scratch.Set "categories" .Page.Params.categories -}}
  {{ end }}
{{ else if not .Date.IsZero }}
  {{ .Scratch.Set "updated_time" (.Date.Format $iso8601 | safeHTML) }}
{{ end }}

{{/* Create meta tags using the values stored in `.Scratch` */}}
<meta property="og:url" content="{{ .Scratch.Get "url" }}" />
<meta property="og:site_name" content="{{ .Scratch.Get "site_name" }}" />
{{ with .Scratch.Get "title "}}
<meta name="twitter:title" content="{{ . }}" />
<meta property="og:title" content="{{ . }}" />
{{ end }}
{{ with .Scratch.Get "description" }}
<meta property="og:description" content="{{ . }}" />
<meta name="twitter:description" content="{{ . }}" />
{{ end }}
{{ with .Scratch.Get "image" }}
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="{{ . }}" />
<meta property="og:image" content="{{ . }}" />
{{ end }}
{{ with .Scratch.Get "published_time" }}
<meta property="article:published_time" content="{{ . }}" />
{{ end }}
{{ with .Scratch.Get "modified_time" }}
<meta property="article:modified_time" content="{{ . }}" />
{{ end }}
{{ with .Scratch.Get "section" }}
<meta property="article:section" content="{{ . }}" />
{{ end }}
{{ with .Scratch.Get "categories" }}
  {{ range first 6 . }}
<meta property="article:tag" content="{{ . }}" />
  {{ end }}
{{ end }}
{{ with .Scratch.Get "updated_time" }}
<meta property="og:updated_time" content="{{ . }}" />
{{ end }}

{{/* Feed the entire context to generate the content and time tags */}}
{{ partial "cards/content.html" . }}