{{- $precision_injection := templates.Exists "partials/plugin-precision-injection.html" -}}
{{- $comments := site.Params.Theme.InjectionSiteComments -}}
{{ $comment := "<!--Injecting HTML files prefixed with %s-->"  }}
{{- $theme_version := site.Params.Theme.ThemeVersion -}}

<!DOCTYPE html>
<html lang="en">

{{- /* Define the page head */}}
<head>

{{- /* Include the theme version */}}
{{ printf "<!-- theme: Moondeer %s -->" $theme_version | safeHTML }}

{{- if $precision_injection -}}
{{- if $comments -}}
{{ printf $comment "HEAD_TOP" | safeHTML }}
{{- end -}}
{{- $params := (dict "prefix" "HEAD_TOP" "context" $) -}}
{{ partial "plugin-precision-injection.html" $params }}
{{- end -}}

{{- /* Define character set and viewport */}}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" 
      content="width=device-width, initial-scale=1, viewport-fit=cover">

{{- /* Define site author */}}
<meta name="author" content="{{ site.Author.name }}">

{{- /* Create a block defining the page title */}}
{{- block "title" . -}}
{{ partial "head/page-title.html" . }}
{{- end -}}

{{- /* Create a block defining the page description */}}
{{- block "description" . -}}
{{ partial "head/page-description.html" . }}
{{- end -}}

{{- /* Include links for the feeds */}}
{{- partial "head/feeds.html" . -}}

{{- /* Include links for the micropub, microsub, webmention, etc. */}}
<link rel="authorization_endpoint" 
      href="https://micro.blog/indieauth/auth" />
<link rel="token_endpoint" href="https://micro.blog/indieauth/token" />
<link rel="micropub" href="https://micro.blog/micropub" />
<link rel="microsub" href="https://micro.blog/microsub" />
<link rel="webmention" href="https://micro.blog/webmention" />
<link rel="subscribe" href="https://micro.blog/users/follow" />


{{- /* Include core stylesheets */}}
<link rel="stylesheet" href="https://use.typekit.net/nmn4mcn.css">

{{ $reset := resources.Get "sass/reset.scss" | toCSS | fingerprint }}
{{ $base := resources.Get "sass/base.scss" | toCSS | fingerprint }}
{{ $nav := resources.Get "sass/nav.scss" | toCSS | fingerprint }}
{{ $typography := resources.Get "sass/typography.scss" | toCSS | fingerprint }}

<link rel="stylesheet" href="{{ $reset.Permalink }}">
<link rel="stylesheet" href="{{ $base.Permalink }}">
<link rel="stylesheet" href="{{ $nav.Permalink }}">
<link rel="stylesheet" href="{{ $typography.Permalink }}">
<link rel="stylesheet" href="/assets/css/highlight.css">

{{- /* Create a block for including any additional stylesheets */}}
{{- block "stylesheets" . -}}
{{ $dark_nav := resources.Get "sass/dark-nav.scss" | toCSS | fingerprint }}
<link rel="stylesheet" href="{{ $dark_nav.Permalink }}">
{{- end -}}

{{- /* Include plugin stylesheets */}}
{{- if $comments -}}
{{ printf "<!--Injecting plugin stylesheets-->" | safeHTML }}
{{- end -}}
{{- range site.Params.plugins_css -}}
<link rel="stylesheet" href="{{ . }}" />
{{- end -}}

{{- /* Include the custom stylesheet last */}}
<link rel="stylesheet" href="{{ "custom.css" | relURL }}">

{{- if $comments -}}
{{ printf "<!--Injecting HTML files without a prefix-->" | safeHTML }}
{{- end }}
{{- if $precision_injection -}}
{{- $params := (dict "context" $) -}}
{{ partial "plugin-precision-injection.html" $params }}
{{- else -}}
{{- range site.Params.plugin_html -}}
{{ partial . $ }}
{{- end -}}
{{- end }}

{{- /* Create a block for including any additional head elements */}}
{{- block "head" . }}{{ end }}

{{- /* Close the page head */}}
</head>

{{- /* Define the page body */}}
<body>

{{- if $precision_injection -}}
{{- if $comments -}}
{{ printf $comment "ABOVE_HEADER" | safeHTML }}
{{- end }}
{{- $params := (dict "prefix" "ABOVE_HEADER" "context" $) -}}
{{- partial "plugin-precision-injection.html" $params }}
{{- end -}}

{{- /* Create a block for encapsulating navigation */}}
{{- block "navigation" . -}}

{{- /* Include default that handles most pages */}}
<nav class="main-nav">
<a href="/">Latest</a>
{{- $page := . }}
{{- range site.Menus.main }}
<a class="{{ cond ($page.IsMenuCurrent "main" .) "selected" "" }}" 
   href="{{ .URL }}"><nobr>{{ .Title }}</nobr></a>
{{- end }}
</nav>

{{- partial "header/banner.html" . -}}

{{- end -}}

{{- /* Define a block for the primary page content */}}
{{- block "main" . }}{{ end -}}

{{- /* Create a block for the page footer */}}
{{- block "footer" . -}}
<footer id="footer">

{{- /* Create a list with feed links and email */}}
{{- partial "footer/link-list.html" . -}}

</footer>
{{- end -}}

{{- /* Include the custom footer */}}
{{- partial "custom_footer.html" . -}}

{{- if $precision_injection -}}
{{- if $comments -}}
{{ printf $comment "BELOW_FOOTER" | safeHTML }}
{{- end }}
{{- $params := (dict "prefix" "BELOW_FOOTER" "context" $) -}}
{{- partial "plugin-precision-injection.html" $params }}
{{- end -}}

{{- with site.Copyright -}}
<footer id="copyright"><small>{{ replace . "{year}" now.Year }}</small></footer>
{{- end -}}

{{- /* Insert plugin Javascript includes */}}
{{- range site.Params.plugins_js -}}
<script src="{{ . }}"></script>
{{- end -}}

{{- /* Include visible theme version if flagged */}}
{{- partial "header/theme-version.html" . }}

{{- /* Close the page body and html */}}
</body>
</html>